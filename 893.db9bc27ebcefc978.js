(self.webpackChunkcd_moduleman=self.webpackChunkcd_moduleman||[]).push([[893],{60893:(w,g,r)=>{r.r(g),r.d(g,{ConsumerModule:()=>_});var p=r(35228),u=r(30533),h=r(83781),f=r(76380),v=r(92618),M=r(59707),I=r(15006),m=r(92526),t=r(23008),n=r(49284),l=r(37011),b=r(33635);const F=new t.FormsService,C=[{title:"ID",name:"consumerId",dbName:"consumer_id",type:t.FieldType.string,fetchable:!0,updateable:!0,index:!0,show:!0,controls:[{controlType:t.ControlType.text,fieldFor:t.FieldFor.tableDisplay}],formatt:"alphanum"},{title:"Guid",name:"consumerGuid",dbName:"consumer_guid",type:t.FieldType.string,fetchable:!0,updateable:!0,searchable:!0,show:!0,controls:[{controlType:t.ControlType.text,fieldFor:t.FieldFor.tableDisplay}],formatt:"alphanum",disabled:!0},{title:"Name",name:"consumerName",dbName:"consumer_name",type:t.FieldType.string,fetchable:!0,updateable:!0,searchable:!0,show:!0,controls:[{controlType:t.ControlType.text,fieldFor:t.FieldFor.createForm},{controlType:t.ControlType.text,fieldFor:t.FieldFor.tableDisplay}],formatt:"text",isNameField:!0,savable:!0,formControlsConfig:["",[u.Validators.minLength(3),u.Validators.maxLength(60),u.Validators.required]]},{title:"Company",name:"companyId",dbName:"company_id",type:t.FieldType.string,fetchable:!0,updateable:!0,index:!0,show:!0,controls:[{controlType:t.ControlType.text,fieldFor:t.FieldFor.tableDisplay},{controlType:t.ControlType.searchDropDown,fieldFor:t.FieldFor.createForm}],ddlInfo:{selData$:(0,b.of)([]),selValueField:"companyName",selIndex:"companyId",selPlaceholder:"...Choose",data:null},formatt:"text",disabled:!0,savable:!0,formControlsConfig:["",[u.Validators.minLength(3),u.Validators.maxLength(42),u.Validators.required]]},{title:"Enabled",name:"consumerEnabled",dbName:"consumer_enabled",type:t.FieldType.boolean,fetchable:!0,updateable:!0,searchable:!0,show:!0,controls:[{controlType:t.ControlType.status,fieldFor:t.FieldFor.tableDisplay}],formatt:"text",isNameField:!0,savable:!0},{title:"Action",name:"action",type:t.FieldType.action,fetchable:!1,show:!0,controls:[{controlType:t.ControlType.action,fieldFor:t.FieldFor.tableDisplay},{controlType:t.ControlType.action,fieldFor:t.FieldFor.createForm}],Fn:"createConsumer"},{title:"Search",name:"iconSearch",type:t.FieldType.any,controls:[],formControlsConfig:["",[]]}],O={data:{},valid:null,ctx:"Sys"},d={token:"",stepTitle:"Create Consumer",stepItems:{nextButtonId:"stepToMenu"},tabPaneId:"consumerInfo",cardTitle:"Consumer Information",cardTitleDesc:"Fill all information below",module:"Moduleman",controller:"Consumer",formGroup:null,fields:F.filterByFieldFor(C,t.FieldFor.createForm)},Q={name:"Consumer Wizard",steps:[d]},N={select:["consumerId","consumerName","consumerGuid"],where:{}},j={getFn$:null,selIndex:N.select[0],selValueField:N.select[1],fetchFields:N.select,step:null,token:null,controlName:"consumerId"},k=[{menuName:"create",menuGuid:"bd9b5bda5ab",navLocation:"/moduleman/consumer/create",actionType:t.ActionType.navigate},{menuName:"dashboard",menuGuid:"d27294db59c1",navLocation:"/moduleman/consumer/dashboard",actionType:t.ActionType.navigate}];var o=r(87675);class P{constructor(e,s,a,i,y,S,T){this.aRoute=e,this.router=s,this.svBase=a,this.svNazTable=i,this.svAcl=y,this.svPage=S,this.svSess=T,this.dSource={fields:[],data:[]},this.cardTitle="Consumer",this.cardBodyId="consumer",this.searchInputId="inputSearchConsumer",this.filter={},this.tpData=t.DEFAULT_TPD,this.ddlData=k,this.init()}ngOnInit(){this.aRoute.queryParams.subscribe(e=>{e&&this.svAcl.initComponent(e,this,this.svSess).then(s=>{})})}init(){this.baseModel=new t.BaseModel(d.module,d.controller),this.svBase.module=d.module,this.svBase.controller=d.controller,this.baseModel.data.fields=C.filter(e=>e.fetchable||e.type===t.FieldType.action),this.baseModel.breadCrumbItems=this.svPage.setBreadCrumbs(d.controller,"List"),this.sQuery=this.svNazTable.initSQuery(this),this.dsEmittData=this.svNazTable.initEmittData(this)}execQuery(e){this.svNazTable.execQuery(e,this.svBase.getPaged$(this.sQuery,this.baseModel.sess.cd_token),this)}setSearchQuery(e){this.sQuery=e.sQuery,this.execQuery(e)}getSelect(){return this.baseModel.data.fields.filter(e=>e.fetchable).map(e=>e.name)}}P.\u0275fac=function(e){return new(e||P)(o.\u0275\u0275directiveInject(l.ActivatedRoute),o.\u0275\u0275directiveInject(l.Router),o.\u0275\u0275directiveInject(t.BaseService),o.\u0275\u0275directiveInject(n.NazTableService),o.\u0275\u0275directiveInject(t.AclService),o.\u0275\u0275directiveInject(n.PageService),o.\u0275\u0275directiveInject(t.SessService))},P.\u0275cmp=o.\u0275\u0275defineComponent({type:P,selectors:[["app-list"]],viewQuery:function(e,s){if(1&e&&o.\u0275\u0275viewQuery(n.NazTableComponent,5),2&e){let a;o.\u0275\u0275queryRefresh(a=o.\u0275\u0275loadQuery())&&(s.nazTable=a.first)}},decls:1,vars:7,consts:[[3,"baseModel","cardTitle","cardBodyId","searchInputId","tpData","filter","ddlData","searchQuery"]],template:function(e,s){1&e&&(o.\u0275\u0275elementStart(0,"naz-table",0),o.\u0275\u0275listener("searchQuery",function(i){return s.setSearchQuery(i)}),o.\u0275\u0275elementEnd()),2&e&&o.\u0275\u0275property("baseModel",s.baseModel)("cardTitle",s.cardTitle)("cardBodyId",s.cardBodyId)("searchInputId",s.searchInputId)("tpData",s.tpData)("filter",s.filter)("ddlData",s.ddlData)},dependencies:[n.NazTableComponent]});var L=r(15861);class R{constructor(e,s,a,i,y,S,T){this.aRoute=e,this.router=s,this.svBase=a,this.svPage=i,this.svSess=y,this.svAcl=S,this.svNotif=T,this.formConfig={},this.init()}ngOnInit(){this.aRoute.queryParams.subscribe(e=>{this.svAcl.initComponent(e,this,this.svSess).then(s=>{})})}init(){this.baseModel=new t.BaseModel(d.module,d.controller),this.baseModel.breadCrumbItems=this.svPage.setBreadCrumbs(d.controller,"Edit"),this.baseModel.data.subTitle="only allowed fields are editable"}update(e){var s=this;return(0,L.Z)(function*(){s.svBase.update$(e,s.baseModel.token).subscribe(a=>{s.svNotif.emitNotif({pushRecepients:t.DEFAULT_PUSH_RECEPIENTS,pushData:a,emittEvent:"push-notif",triggerEvent:"send-notif",req:null,resp:a})})})()}}R.\u0275fac=function(e){return new(e||R)(o.\u0275\u0275directiveInject(l.ActivatedRoute),o.\u0275\u0275directiveInject(l.Router),o.\u0275\u0275directiveInject(t.BaseService),o.\u0275\u0275directiveInject(n.PageService),o.\u0275\u0275directiveInject(t.SessService),o.\u0275\u0275directiveInject(t.AclService),o.\u0275\u0275directiveInject(t.NotificationService))},R.\u0275cmp=o.\u0275\u0275defineComponent({type:R,selectors:[["app-edit"]],decls:1,vars:2,consts:[[3,"baseModel","pageDescription","formConfig","updateQuery"]],template:function(e,s){1&e&&(o.\u0275\u0275elementStart(0,"naz-table-edit",0),o.\u0275\u0275listener("updateQuery",function(i){return s.update(i)}),o.\u0275\u0275elementEnd()),2&e&&o.\u0275\u0275property("baseModel",s.baseModel)("formConfig",s.formConfig)},dependencies:[n.EditComponent]});class A{constructor(e,s,a,i,y,S,T){this.aRoute=e,this.router=s,this.svBase=a,this.svPage=i,this.svAcl=y,this.svNotif=S,this.svSess=T,this.formConfig={},this.init()}ngOnInit(){this.aRoute.queryParams.subscribe(e=>{this.svAcl.initComponent(e,this,this.svSess).then(s=>{})})}init(){this.baseModel=new t.BaseModel(d.module,d.controller),this.baseModel.breadCrumbItems=this.svPage.setBreadCrumbs(d.controller,"Delete"),this.baseModel.data.subTitle="confirm before delete"}deleteItem(e){var s=this;return(0,L.Z)(function*(){s.svBase.delete$(e,s.baseModel.token).subscribe(a=>{s.svNotif.emitNotif({pushRecepients:t.DEFAULT_PUSH_RECEPIENTS,pushData:a,emittEvent:"push-notif",triggerEvent:"send-notif",req:null,resp:a})})})()}}A.\u0275fac=function(e){return new(e||A)(o.\u0275\u0275directiveInject(l.ActivatedRoute),o.\u0275\u0275directiveInject(l.Router),o.\u0275\u0275directiveInject(t.BaseService),o.\u0275\u0275directiveInject(n.PageService),o.\u0275\u0275directiveInject(t.AclService),o.\u0275\u0275directiveInject(t.NotificationService),o.\u0275\u0275directiveInject(t.SessService))},A.\u0275cmp=o.\u0275\u0275defineComponent({type:A,selectors:[["app-delete"]],decls:1,vars:2,consts:[[3,"baseModel","pageDescription","formConfig","deleteQuery"]],template:function(e,s){1&e&&(o.\u0275\u0275elementStart(0,"naz-table-delete",0),o.\u0275\u0275listener("deleteQuery",function(i){return s.deleteItem(i)}),o.\u0275\u0275elementEnd()),2&e&&o.\u0275\u0275property("baseModel",s.baseModel)("formConfig",s.formConfig)},dependencies:[n.DeleteComponent]});var $=r(95855);class E{constructor(e,s){this.svBase=e,this.svModman=s}loadDdls(e,s){var a=this;return(0,L.Z)(function*(){j.token=e.token,j.step=s,j.controlName="consumerId",console.log("ConsumerModService::loadDdls()/consumerGetQuery:",N),j.getFn$=a.svBase.getPaged$(N,e.token,"Sys","Moduleman","Consumer"),yield a.svModman.setDdl$(yield j).subscribe(i=>{console.log("consumer/ConsumerModService::loadDdls()/ret(consumers):",i),s.fields.forEach(y=>{"consumerId"===y.name&&(y.ddlInfo.data=i)})})})()}}E.\u0275fac=function(e){return new(e||E)(o.\u0275\u0275inject(t.BaseService),o.\u0275\u0275inject($.v))},E.\u0275prov=o.\u0275\u0275defineInjectable({token:E,factory:E.\u0275fac,providedIn:"root"});class B{constructor(e,s,a,i,y,S,T,G,x,K,H,W,Z,J){this.aRoute=e,this.router=s,this.svServer=a,this.svConsumerFront=i,this.svAcl=y,this.svForm=S,this.svNotif=T,this.fb=G,this.svForms=x,this.svModman=K,this.svPage=H,this.svPush=W,this.svBase=Z,this.svSess=J,this.newConsumer=O,this.wizardModel=Q,this.init()}ngOnInit(){this.aRoute.queryParams.subscribe(e=>{this.svAcl.initComponent(e,this,this.svSess).then(s=>{s&&(this.svPush.init(this),this.baseModel.data.step.token=this.baseModel.token)})})}ngAfterViewInit(){this.svConsumerFront.loadDdls(this.baseModel,this.baseModel.data.step).then(e=>{console.log("consumer/CreateComponent::ngAfterViewInit()/this.baseModel.data.step:",this.baseModel.data.step)})}init(){this.baseModel=new t.BaseModel(d.module,d.controller),this.baseModel.data.fields=this.svForms.filterByFieldFor(C,t.FieldFor.createForm),this.baseModel.data.wizardModel=Q,this.baseModel.data.step=this.svForm.filterStepsByController(this.baseModel.data.wizardModel,d.controller)[0],this.baseModel.data.form=this.fb.group(this.svForm.getFormControlConfig(C)),this.baseModel.data.step.formGroup=this.baseModel.data.form,this.baseModel.breadCrumbItems=this.svPage.setBreadCrumbs(d.controller,"Create")}setSelectedIcon(e){this.svForm.setSelectedIcon(e,this.baseModel,this.baseModel.data.step)}save(e){switch(console.log("consumer/CreateComponent::save()/01"),console.log("consumer/CreateComponent::save()/step:",e),e.controller){case"module":case"menu":break;case"Consumer":if(console.log("consumer/CreateComponent::save()/handling consumer"),console.log("consumer/CreateComponent::save()/step.formGroup.value:",e.formGroup.value),"VALID"===e.formGroup.status){console.log("consumer/CreateComponent::save()/validation success");let a={ctx:"Sys",m:"Moduleman",c:"Consumer",a:"Create",dat:{f_vals:[{data:{}}],token:""},args:{}};a.dat.f_vals[0].data={...e.formGroup.value},a.dat.token=this.baseModel.token,console.log("consumer/CreateComponent::save()/env:",a),this.svServer.proc(a).subscribe(i=>{console.log("consumer/CreateComponent::save()/Consumer/resp:",i)})}else console.log("consumer/CreateComponent::save()/Validation Error orccured")}}finishFunction(){console.log("finishing!!")}}B.\u0275fac=function(e){return new(e||B)(o.\u0275\u0275directiveInject(l.ActivatedRoute),o.\u0275\u0275directiveInject(l.Router),o.\u0275\u0275directiveInject(t.ServerService),o.\u0275\u0275directiveInject(E),o.\u0275\u0275directiveInject(t.AclService),o.\u0275\u0275directiveInject(t.FormsService),o.\u0275\u0275directiveInject(t.NotificationService),o.\u0275\u0275directiveInject(u.FormBuilder),o.\u0275\u0275directiveInject(t.FormsService),o.\u0275\u0275directiveInject($.v),o.\u0275\u0275directiveInject(n.PageService),o.\u0275\u0275directiveInject(t.CdPushService),o.\u0275\u0275directiveInject(t.BaseService),o.\u0275\u0275directiveInject(t.SessService))},B.\u0275cmp=o.\u0275\u0275defineComponent({type:B,selectors:[["app-create"]],decls:1,vars:2,consts:[[3,"baseModel","wizardModel","saveEmitter","relaySelIconEmitter"]],template:function(e,s){1&e&&(o.\u0275\u0275elementStart(0,"naz-table-create",0),o.\u0275\u0275listener("saveEmitter",function(i){return s.save(i)})("relaySelIconEmitter",function(i){return s.setSelectedIcon(i)}),o.\u0275\u0275elementEnd()),2&e&&o.\u0275\u0275property("baseModel",s.baseModel)("wizardModel",s.wizardModel)},dependencies:[n.CreateComponent]});var U=r(86106);const V=[{path:"list",component:P},{path:"edit",component:R},{path:"delete",component:A},{path:"create",component:B},{path:"dashboard",component:U.M}];class D{}D.\u0275fac=function(e){return new(e||D)},D.\u0275mod=o.\u0275\u0275defineNgModule({type:D}),D.\u0275inj=o.\u0275\u0275defineInjector({imports:[l.RouterModule.forChild(V),l.RouterModule]});class _{}_.\u0275fac=function(e){return new(e||_)},_.\u0275mod=o.\u0275\u0275defineNgModule({type:_}),_.\u0275inj=o.\u0275\u0275defineInjector({imports:[p.CommonModule,u.FormsModule,u.ReactiveFormsModule,f.NgbNavModule,f.NgbDropdownModule,f.NgbTooltipModule,f.NgbAccordionModule,n.NazUiModule,n.NazTableModule,n.NazCreateModule,n.NazEditModule,n.NazDeleteModule,v.Ng2SearchPipeModule,M.ArchwizardModule,I.NgToggleModule,D,h.NgSelectModule,t.BaseModule.forChild(m.N),t.CdPushModule.forChild(m.N)]})},95855:(w,g,r)=>{r.d(g,{v:()=>m});var p=r(33635),h=r(87675),v=r(23008);class m{constructor(n,l,b){this.svMenu=n,this.svNotif=l,this.svForm=b,this.ddlData={config:{suppressScrollX:!0,wheelSpeed:.3},header:{title:{lable:"Notifications",cls:"",action:null},sideLink:{lable:"View All",cls:"",action:null}},footer:{label:"View All",icon:"",action:null},data:[{label:"item 1",description:"If several languages coalesce the grammar",time:"3 min ago"},{label:"item 2",description:"It will seem like simplified English",time:"1 hr ago"},{label:"item 3",description:"If several languages coalesce the grammar",time:"4 hr ago"}]},this.pushEnvelop={pushRecepients:[],pushData:null,emittEvent:"push-notif",triggerEvent:"send-notif",req:null,resp:null},this.numericNumberReg1="^-?[0-9]\\d*(\\.\\d{1,2})?$",this.numericNumberReg2="/^[0-9]d*$/",this.numericNumberReg3=new RegExp(/^-?[0-9]\\d*(\\.\\d{1,2})?$/,"i"),this.numericNumberReg4=new RegExp(/^[0-9]\d*$/,"i")}setIconsData$(n,l){n.fields.map((b,F)=>{b.name===l&&(n.fields[F].ddlInfo.selData$=(0,p.of)(this.ddlData),n.fields[F].ddlInfo.selIndex="iconId",n.fields[F].ddlInfo.selValueField="iconName",n.fields[F].ddlInfo.selPlaceholder="...Choose")})}setDdl$(n){if(n.token){const l=new p.Subject;let b=[];return n.getFn$.subscribe(F=>{const C=F;console.log("ModulemanService::setDdl$()/response:",C),C.app_state.success?(b=C.data.items,n.step.fields.map((O,d)=>{O.name===n.controlName&&(n.step.fields[d].ddlInfo.selData$=(0,p.of)(C.data.items),n.step.fields[d].ddlInfo.selIndex=n.selIndex,n.step.fields[d].ddlInfo.selValueField=n.selValueField,n.step.fields[d].ddlInfo.selPlaceholder="...Choose")}),l.next(b)):(this.pushEnvelop.pushData=C,this.pushEnvelop.resp=C,this.svNotif.emitNotif(this.pushEnvelop),l.next(b))}),l.asObservable()}return(0,p.of)([])}}m.\u0275fac=function(n){return new(n||m)(h.\u0275\u0275inject(v.MenuService),h.\u0275\u0275inject(v.NotificationService),h.\u0275\u0275inject(v.FormsService))},m.\u0275prov=h.\u0275\u0275defineInjectable({token:m,factory:m.\u0275fac,providedIn:"root"})},92526:(w,g,r)=>{r.d(g,{N:()=>I});const p="https://cd-api.co.ke",I={appId:"",production:!1,apiEndpoint:`${p}:3001/api`,sioEndpoint:`${p}:3002`,wsEndpoint:"ws://cd-api.co.ke:3000",wsMode:"wss",pushConfig:{sio:{enabled:!0},wss:{enabled:!1},pusher:{enabled:!0,apiKey:"DtVRY9V5j41KwSxKrd8L_dRijUJh9gVcqwBH5wb96no",options:{cluster:"ap2",forceTLS:!0,userAuthentication:{endpoint:"https://cd-api.co.ke:3002/pusher/auth",transport:"ajax",params:{},headers:{},includeCredentials:!0,customHandler:null},channelAuthorization:{endpoint:"https://cd-api.co.ke:3002/pusher/auth"},authEndpoint:"https://cd-api.co.ke:3002/pusher/auth"}}},CD_PORT:3001,consumerToken:"B0B3DA99-1859-A499-90F6-1E3F69575DCD",clientContext:{entity:"ASDAP",clientAppId:2,consumerToken:"B0B3DA99-1859-A499-90F6-1E3F69575DCD"},USER_RESOURCES:"http://routed-93/user-resources",apiHost:"https://cd-api.co.ke",sioHost:"https://cd-api.co.ke",shellHost:"https://asdap.net",consumer:"",clientAppGuid:"ca0fe39f-92b2-484d-91ef-487d4fc462a2",clientAppId:2,SOCKET_IO_PORT:3002,defaultauth:"cd-auth",mfManifestPath:"/assets/mf.manifest.json",apiOptions:{headers:{"Content-Type":"application/json"}},sioOptions:{path:"/socket.io",transports:["websocket","polling"],secure:!0},firebaseConfig:{apiKey:"",authDomain:"",databaseURL:"",projectId:"",storageBucket:"",messagingSenderId:"",appId:"",measurementId:""}}},15861:(w,g,r)=>{function p(h,f,v,M,I,m,t){try{var n=h[m](t),l=n.value}catch(b){return void v(b)}n.done?f(l):Promise.resolve(l).then(M,I)}function u(h){return function(){var f=this,v=arguments;return new Promise(function(M,I){var m=h.apply(f,v);function t(l){p(m,M,I,t,n,"next",l)}function n(l){p(m,M,I,t,n,"throw",l)}t(void 0)})}}r.d(g,{Z:()=>u})}}]);